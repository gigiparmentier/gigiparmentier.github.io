<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>My kazakh words</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Balsamiq+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/1c5060d9dc.js" crossorigin="anonymous"></script>
</head>
<body>
    <div id="wave_top">
        <svg viewBox="0 0 1000 150" preserveAspectRatio="none" style="height: 100%; width: 100%;">
          <path d="M1000,101.71c0,0-106.81-108.65-238.66,0s-261.34,0-261.34,0s-106.81-108.65-238.66,0S0,101.71,0,101.71V0h1000 V101.71z" style="stroke: none;fill: #f2e269;"></path>
        </svg>
    </div>
    <h1 id="title"><i class="fa-solid fa-sun"></i>   My kazakh words   <i class="fa-solid fa-sun"></i></h1>
    <div id="search_bar_div">
        <input id="search_bar" type="text" id="search_input" placeholder="" autofocus>
    </div>
    <div id="words_outer"><div id="words"></div></div></div>
    <div id="guess_game">
        <h2>Guess the word</h2>
        <p id="guess_word"></p>
        <input id="guess_input" type="text" placeholder="Enter a guess" autofocus>
        <p id="guess_result"></p>
    </div>
    <div id="letters_div">
        <h2>Kazakh alphabet</h2>
    </div>
    <h2>Cases</h2>
    <div id="cases_div">
        <table id="cases">
            <tr>
                <th>Case</th>
                <th>Sing. 1st person</th>
                <th>Sing. 2nd person</th>
                <th>Sing. 3rd person</th>
                <th>Plur. 1st person</th>
                <th>Plur. 2nd person</th>
                <th>Plur. 3rd person</th>
            </tr>
            <tr>
                <td>Nominative</td>
                <td>мен</td>
                <td>сен</td>
                <td>ол</td>
                <td>біз</td>
                <td>сенер</td>
                <td>олар</td>
            </tr>
            <tr>
                <td>Accusative</td>
                <td>мені</td>
                <td>сені</td>
                <td>оны</td>
                <td>бізді</td>
                <td>сендерді</td>
                <td>оларды</td>
            </tr>
            <tr>
                <td>Genitive</td>
                <td>менің</td>
                <td>сенің</td>
                <td>оның</td>
                <td>біздің</td>
                <td>сендердің</td>
                <td>олардың</td>
            </tr>
            <tr>
                <td>Dative</td>
                <td>маған</td>
                <td>саған</td>
                <td>оған</td>
                <td>бізге</td>
                <td>сендерге</td>
                <td>оларға</td>
            </tr>
            <tr>
                <td>Locative</td>
                <td>менде</td>
                <td>сенде</td>
                <td>онда</td>
                <td>бізде</td>
                <td>сендерде</td>
                <td>оларда</td>
            </tr>
            <tr>
                <td>Ablative</td>
                <td>менен</td>
                <td>сенен</td>
                <td>одан</td>
                <td>бізден</td>
                <td>сендерден</td>
                <td>олардан</td>
            </tr>
            <tr>
                <td>Instrumental</td>
                <td>менімен</td>
                <td>сенімен</td>
                <td>онымен</td>
                <td>бізбен</td>
                <td>сендермен</td>
                <td>олармен</td>
            </tr>
        </table>
    </div>

    <h2>Present/Future Time conjugation</h2>
    <table id="vowels_table">
        <tr>
            <td>Hard vowels:</td>
            <td>Аа</td>
            <td></td>
            <td></td>
            <td>Оо</td>
            <td>Уу</td>
            <td>Ұұ</td>
            <td>Ыы</td>
        </tr>
        <tr>
            <td>Soft vowels:</td>
            <td>Әә</td>
            <td>Ее</td>
            <td>Ии</td>
            <td>Өө</td>
            <td></td>
            <td>Үү</td>
            <td>Іі</td>
        </tr>
    </table>
    <div id="verb_div">
        <table id="verb">
            <tr>
                <th>Person</th>
                <th>Ends w/ soft vowel</th>
                <th>Ends w/ hard vowel</th>
                <th>Ends w/ soft vowel + cons.</th>
                <th>Ends w/ hard vowel + cons.</th>
            </tr>
            <tr>
                <td>1st sing. мен</td>
                <td>-ймін</td>
                <td>-ймын</td>
                <td>-емін</td>
                <td>-амын</td>
            </tr>
            <tr>
                <td>2nd sing. сен</td>
                <td>-йсің</td>
                <td>-йсың</td>
                <td>-есің</td>
                <td>-асың</td>
            </tr>
            <tr>
                <td>3rd sing. ол</td>
                <td>-йді</td>
                <td>-йды</td>
                <td>-еді</td>
                <td>-ады</td>
            </tr>
            <tr>
                <td>1st plur. біз</td>
                <td>-йміз</td>
                <td>-ймыз</td>
                <td>-еміз</td>
                <td>-амыз</td>
            </tr>
            <tr>
                <td>2nd plur. сендер</td>
                <td>-йсіңдер</td>
                <td>-йсыңдар</td>
                <td>-есіңдер</td>
                <td>-асыңдар</td>
            </tr>
            <tr>
                <td>3rd plur. олар</td>
                <td>-йді</td>
                <td>-йды</td>
                <td>-еді</td>
                <td>-ады</td>
            </tr>
        </table>
    </div>


    <div id="wave_bottom">
        <svg viewBox="0 0 1000 150" preserveAspectRatio="none" style="height: 100%; width: 100%;">
          <path d="M1000,48.29c0,0-106.81,108.65-238.66,0s-261.34,0-261.34,0s-106.81,108.65-238.66,0S0,48.29,0,48.29V150h1000 V48.29z" style="stroke: none;fill: #f2e269;"></path>
        </svg>
    </div>
    <script>
        var words_list = [];
        var shuffled_list = [];
        var guess_index = 0;
        var alphabet = ["а","ә","б","в","г","ғ","д","е","ж","з","и","й","к","қ","л","м","н","ң","о","ө","п","р","с","т","у","ұ","ү","ф","х","һ","ц","ч","ш","щ","ы","і","э","ю","я"];
        var letter_duration = new Array(alphabet.length).fill(0);

        $(document).ready(function(){
            var url = "https://gigiparmentier.github.io/kazakh/words.txt";
            $.get({url: url,cache: false}).then(function(data) {
                var lines = data.split("\n").reverse();
                var wordsDiv = $("#words");

                $('#search_bar').attr('placeholder', 'Search in ' + lines.length + ' words');
                $('#search_bar').val('');

                lines.forEach(function(line) {
                    var parts = line.split(":");
                    var k_words = parts[0].trim();
                    var e_words = parts[1].trim();
                    var f_words = parts[2].trim();

                    words_list.push({k_words: k_words, e_words: e_words, f_words: f_words});
                    k_words = k_words.replace(/,/g,", ");
                    e_words = e_words.replace(/,/g,", ");
                    f_words = f_words.replace(/,/g,", ");
                    
                    var wordElement = $("<p>").text(k_words + ' : ' + e_words);
                    wordElement.attr('k_words', k_words);
                    wordElement.attr('e_words', e_words);
                    wordElement.attr('f_words', f_words);
                    wordElement.addClass("word");
                    wordElement.on("click", play_word_sound);

                    wordsDiv.append(wordElement);
                });
                shuffled_list = shuffleArray(words_list);
                start_game();
            });

            for (var i = 0; i < alphabet.length; i++) {
                var letter = $("<p>").text(alphabet[i]);
                letter.addClass("letter");
                letter.on("click", play_letter_sound);
                $("#letters_div").append(letter);
                var url = 'https://gigiparmentier.github.io/kazakh/word_sounds/' + alphabet[i] + '.mp3';
                var audio = new Audio(url);
                get_audio_duration(audio,i);
                audio.src = url;
            }
        });

        function get_audio_duration(audio,i){
            $(audio).on("loadedmetadata", function(){
                letter_duration[i] = audio.duration;
            });
        }

        $("#search_bar").on("input", function() {
            var searchValue = $(this).val().toLowerCase();
            $(".word").each(function() {
                var kWords = $(this).attr("k_words").toLowerCase();
                var eWords = $(this).attr("e_words").toLowerCase();
                var fWords = $(this).attr("f_words").toLowerCase();
                if (kWords.includes(searchValue) || eWords.includes(searchValue) || fWords.includes(searchValue)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });

        $('#guess_input').on('keypress', function(e) {
            if(e.which != 13) {
                return;
            }
            var guess = $(this).val().toLowerCase();
            var eWords = $('#guess_word').attr('e_words').toLowerCase().split(",");
            $('#guess_result').css('opacity',1);
            if (eWords.includes(guess)) {
                $("#guess_result").text("Correct!");
                guess_index++;
                if (guess_index >= words_list.length) {
                    guess_index = 0;
                    shuffled_list = shuffleArray(words_list);
                }
                start_game();
            } else {
                $("#guess_result").text("Nope!");
            }
            setTimeout(function() {
                $('#guess_result').animate({ opacity: 0 });
            }, 500);
        });

        function play_audio_index(url,time){
            setTimeout(function() {
                var audio = new Audio(url);
                audio.play();
            }, time * 1000);
        }

        function play_word_sound(){
            var letters = $(this).attr('k_words').split("");
            var total_duration = 0;
            for (var i = 0; i < letters.length; i++) {
                if (letters[i] == " ") {
                    total_duration += 0.25;
                    continue;
                }
                else if (alphabet.indexOf(letters[i].toLowerCase()) == -1) {
                    continue;
                }
                var letter = letters[i].toLowerCase();
                var url = 'https://gigiparmentier.github.io/kazakh/word_sounds/' + letter + '.mp3';
                var audio = new Audio(url);
                audio.src = url;
                play_audio_index(url,total_duration);
                total_duration += letter_duration[alphabet.indexOf(letter)];
            }
        }

        function play_letter_sound(){
            var audio = new Audio('https://gigiparmentier.github.io/kazakh/sounds/' + $(this).html() + '.mp3');
            audio.play();
        }

        function start_game() {
            var word = shuffled_list[guess_index];
            $("#guess_word").text(word.k_words);
            $('#guess_word').attr('k_words', word.k_words);
            $('#guess_word').attr('e_words', word.e_words);
            $('#guess_word').attr('f_words', word.f_words);
            var col = $('.word[k_words="' + word.k_words + '"]').css('background-color');
            $("#guess_word").css("background-color", col);
            $("#guess_input").val("");
        }

        function shuffleArray(array) {
            var newArray = array.slice();
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    </script>
</body>
</html>