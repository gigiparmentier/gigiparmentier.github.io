<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My kazakh words</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Balsamiq+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
</head>
<body>
    <h1 id="title">My kazakh words</h1>
    <input id="search_bar" type="text" id="search_input" placeholder="" autofocus>
    <div id="words_outer"><div id="words"></div></div></div>
    <div id="guess_game">
        <h2>Guess the word</h2>
        <p id="guess_word"></p>
        <input id="guess_input" type="text" placeholder="Enter a guess" autofocus>
        <p id="guess_result"></p>
    </div>
    <script>
        var words_list = [];
        
        $(document).ready(function(){
            var url = "https://gigiparmentier.github.io/kazakh/words.txt";
            $.get({url: url,cache: false}).then(function(data) {
                var lines = data.split("\n").reverse();
                var wordsDiv = $("#words");

                $('#search_bar').attr('placeholder', 'Search in ' + lines.length + ' words');
                $('#search_bar').val('');

                lines.forEach(function(line) {
                    var parts = line.split(":");
                    var k_words = parts[0].trim();
                    var e_words = parts[1].trim();
                    var f_words = parts[2].trim();

                    k_words = k_words.replace(/,/g,", ");
                    e_words = e_words.replace(/,/g,", ");
                    f_words = f_words.replace(/,/g,", ");
                    words_list.push({k_words: k_words, e_words: e_words, f_words: f_words});
                    
                    var wordElement = $("<p>").text(k_words + ' : ' + e_words);
                    wordElement.attr('k_words', k_words);
                    wordElement.attr('e_words', e_words);
                    wordElement.attr('f_words', f_words);
                    wordElement.addClass("word");

                    wordsDiv.append(wordElement);
                });
                start_game();
            });
        });

        $("#search_bar").on("input", function() {
            var searchValue = $(this).val().toLowerCase();
            $(".word").each(function() {
                var kWords = $(this).attr("k_words").toLowerCase();
                var eWords = $(this).attr("e_words").toLowerCase();
                var fWords = $(this).attr("f_words").toLowerCase();
                if (kWords.includes(searchValue) || eWords.includes(searchValue) || fWords.includes(searchValue)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });

        $('#guess_input').on('keypress', function(e) {
            if(e.which != 13) {
                return;
            }
            var guess = $(this).val().toLowerCase();
            var eWords = $('#guess_word').attr('e_words').toLowerCase().split(",");
            $('#guess_result').fadeIn(0);
            if (eWords.includes(guess)) {
                $("#guess_result").text("Correct!");
                start_game();
            } else {
                $("#guess_result").text("Nope!");
            }
            setTimeout(function() {
                $('#guess_result').fadeOut();
            }, 500);
        });

        function start_game() {
            var randomIndex = Math.floor(Math.random() * words_list.length);
            var word = words_list[randomIndex];
            $("#guess_word").text(word.k_words);
            $('#guess_word').attr('k_words', word.k_words);
            $('#guess_word').attr('e_words', word.e_words);
            $('#guess_word').attr('f_words', word.f_words);
            var colors = ['#fbc59f','#f4eb84','#c499e0','#f39f95','#a9e3bb','#a6cdf4','#e6b8b8'];
            var randomColor = colors[Math.floor(Math.random() * colors.length)];
            $("#guess_word").css("background-color", randomColor);
            $("#guess_input").val("");
        }
    </script>
</body>
</html>