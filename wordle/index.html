<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>

<body>
  <div id="header">
    <div id="help" class="button" onclick="toggleHelp()">
      <svg width="24" height="24">
        <path fill="#565758" d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z">
        </path>
      </svg>
    </div>
    <h1 id="title">motle</h1>
    <div id="settings" class="button">
      <svg width="24" height="24">
        <path fill="#565758" d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z">
        </path>
      </svg>
    </div>
  </div>
  <div id="tableDiv">
  </div>
  <div id="helpDiv">
    <div id="helpContent">
      <div id="helpHeader">
        <h2>COMMENT JOUER</h2>
        <div id="close" onclick="toggleHelp()"><svg width="24" height="24"><path fill="#565758" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></svg></path></div>
      </div>
      <p>Devinez le <b>MOTLE</b> en 6 essais.
      <p>Après chaque essai, la couleur des tuiles change pour montrer à quel point votre hypothèse est proche du mot.</p>
      <div class='divider'></div>
      <table class='example_table'>
        <tr>
          <td class='correct'>W</td>
          <td class='undiscovered'>A</td>
          <td class='undiscovered'>G</td>
          <td class='undiscovered'>O</td>
          <td class='undiscovered'>N</td>
        </tr>
      </table>
      <p>La lettre <b>W</b> est dans le mot et au bon endroit.</p>
      <table class='example_table'>
        <tr>
          <td class='undiscovered'>P</td>
          <td class='undiscovered'>A</td>
          <td class='misplaced'>L</td>
          <td class='undiscovered'>E</td>
          <td class='undiscovered'>T</td>
        </tr>
      </table>
      <p>La lettre <b>L</b> est dans le mot mais au mauvais endroit.</p>
      <table class='example_table'>
        <tr>
          <td class='undiscovered'>V</td>
          <td class='undiscovered'>A</td>
          <td class='undiscovered'>G</td>
          <td class='discovered'>U</td>
          <td class='undiscovered'>E</td>
        </tr>
      </table>
      <p>La lettre <b>U</b> n'est nulle part dans le mot.</p>
      <div class='divider'></div>
      <p><b>Un nouveau MOTLE est accessible chaque heure !</b></p>
    </div>
  </div>
  <script>
    current_row = 1;
    var dict_big;
    var dict_small;
    var secret_word;
    $(document).ready(function() {
      generateDicts();
    });

    $(document).keyup(function(e) {
      onLetterInput(e.which);
    });

    $(window).resize(function() {
      resizeCells();
    });

    function toggleHelp(){
      if ($('#helpDiv').is(':visible')){
        $('#helpDiv').fadeOut(100);
        $('#helpDiv').css('padding-top','50%');
      }
      else{
        console.log('up');
        $('#helpDiv').fadeIn(100);
        $('#helpDiv').css('padding-top','0%');
      }
    }

    function onReady(){
      secret_word = dict_small[Math.floor(Math.random()*dict_small.length)];
      addTable();
      addKeyboard();
      resizeCells();
    }

    function resizeCells(){
      $('#table td').css('width',window.innerHeight/15 + 'px');
      $('#table td').css('height',window.innerHeight/15 + 'px');
      $('#tableDiv').css('left',window.innerWidth/2-$('#tableDiv').width()/2);
      $('#keyboard').css('left',window.innerWidth/2-$('#keyboard').width()/2);
    }

    function generateDicts(){
      fetch('dict_small.txt')
      .then(response => response.text())
      .then((data) => {
        dict_small = data.split("\r\n");
        fetch('dict_big.txt')
        .then(response => response.text())
        .then((data) => {
          dict_big = data.split("\r\n");
          onReady();
        })
      })
    }

    function onLetterInput(event_charcode) {
      if (event_charcode >= 65 && event_charcode <= 90) {
        letter_key = String.fromCharCode(event_charcode);
        addLetter(letter_key);
      } else if (event_charcode == 13) {
        guessWord();
      } else if (event_charcode == 8) {
        removeLetter();
      }
    }

    function addLetter(letter){
      for (child of $('#table tr[y=' + current_row + ']').children()) {
        if (child.innerHTML == '') {
          child.innerHTML = letter;
          break;
        }
      }
    }

    function removeLetter(){
      children = $('#table tr[y=' + current_row + ']').children();
      for (var i = 4; i >= 0; i--){
        if (children[i].innerHTML != ''){
          children[i].innerHTML = '';
          break;
        }
      }
    }

    function guessWord(){
      if ($('#table tr[y=' + current_row + ']').children('[x=5]')[0].innerHTML == ''){
        return;
      }
      word = '';
      children = $('#table tr[y=' + current_row + ']').children();
      for (child of children){
        word += child.innerHTML.toLowerCase();
      }
      if (dict_big.includes(word)){
        verifyWord(word);
      }
      else{
        console.log('no');
      }
    }

    function verifyWord(word){
      for (i in word){
        i = parseInt(i);
        if (word[i] == secret_word[i]){
          $('#table tr[y=' + current_row + ']').children('[x='+(i+1)+']').attr('class','correct');
          $('#keyboard [key_letter='+word[i].toUpperCase()+']').addClass('correct');
        }
        else if (secret_word.includes(word[i])){
          $('#table tr[y=' + current_row + ']').children('[x='+(i+1)+']').attr('class','misplaced');
          $('#keyboard [key_letter='+word[i].toUpperCase()+']').addClass('misplaced');
        }
        else{
          $('#table tr[y=' + current_row + ']').children('[x='+(i+1)+']').attr('class','discovered');
          $('#keyboard [key_letter='+word[i].toUpperCase()+']').addClass('discovered');
        }
      }
      current_row += 1;
      if (current_row == 7){
        console.log('perdu');
      }
    }

    function addTable() {
      var table = document.createElement('table');
      table.id = 'table';
      var tableBody = document.createElement('tbody');
      table.appendChild(tableBody);
      for (var i = 0; i < 6; i++) {
        var tr = document.createElement('tr');
        tr.setAttribute('y', i + 1);
        tableBody.appendChild(tr);
        for (var j = 0; j < 5; j++) {
          var td = document.createElement('td');
          td.className = 'undiscovered';
          td.setAttribute('x', j + 1);
          tr.appendChild(td);
        }
      }
      document.getElementById('tableDiv').appendChild(table);
    }

    function addKeyboard() {
      var keyboard = document.createElement('div');
      keyboard.id = 'keyboard';
      letters = [
        ['A', 'Z', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
        ['Q', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
        ['ENTER', 'M', 'W', 'X', 'C', 'V', 'B', 'N', 'SUPPR']
      ]
      for (row_index in letters) {
        var rowDiv = document.createElement('div');
        rowDiv.className = 'key_row';
        if (row_index == 1) {
          spacer = document.createElement('div');
          spacer.className = 'spacer';
          rowDiv.appendChild(spacer);
        }
        for (letter of letters[row_index]) {
          letterDiv = document.createElement('div');
          letterDiv.className = 'key';
          letterDiv.setAttribute('key_letter', letter);
          if (letter == 'SUPPR') {
            letterDiv.setAttribute('onclick','removeLetter()');
            letterDiv.className += ' special_key';
            letterDiv.innerHTML = '<svg width="24" height="24"><path fill="#d7dadc" d="M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H7.07L2.4 12l4.66-7H22v14zm-11.59-2L14 13.41 17.59 17 19 15.59 15.41 12 19 8.41 17.59 7 14 10.59 10.41 7 9 8.41 12.59 12 9 15.59z"></path></svg>'
          }
          else if (letter == 'ENTER'){
            letterDiv.setAttribute('onclick','guessWord()');
            letterDiv.className += ' special_key';
            letterDiv.innerHTML = 'ENTER';
          }
          else {
            letterDiv.setAttribute('onclick','addLetter("'+letter+'")');
            letterDiv.innerHTML = letter;
          }
          rowDiv.append(letterDiv);
        }
        if (row_index == 1) {
          spacer = document.createElement('div');
          spacer.className = 'spacer';
          rowDiv.appendChild(spacer);
        }
        keyboard.appendChild(rowDiv);
      }
      document.body.appendChild(keyboard);
    }
  </script>
</body>

</html>
